<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="vhdi">
<title>Illustration of methodology and functional of vhdi • vhdi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Illustration of methodology and functional of vhdi">
<meta property="og:description" content="vhdi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">vhdi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/vhdi.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Illustration of methodology and functional of vhdi</h1>
            
      
      
      <div class="d-none name"><code>vhdi.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">vhdi</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="vhdi">vhdi<a class="anchor" aria-label="anchor" href="#vhdi"></a>
</h2>
<p>The package vhdi aims to give valid, data-driven highest density
prediction interval.</p>
</div>
<div class="section level2">
<h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h2>
<p>We introduce three methods to generate the prediction intervals with
robust coverage rate and shortest length.</p>
<p>Let <span class="math inline">\(\mathbf{X} =
(X_1,\cdots,X_n)\)</span> be an i.i.d random sample from a distribution
with continuous cumulative distribution function <span class="math inline">\(F\)</span>. For a given nominal error rate <span class="math inline">\(\alpha\)</span>, a <span class="math inline">\(100((1-\alpha)\%\)</span> prediction interval for
an independent future observation <span class="math inline">\(X_{n+1}\)</span> from the same distribution is a
random interval <span class="math inline">\((L(\mathbf{X}),
U(\mathbf{X}))\)</span> such that</p>
<p><span class="math display">\[P(L(\mathbf{X})&lt;X_{n+1}&lt;U(\mathbf{X}))\geq
1-\alpha\]</span></p>
<p>We would like to use different methods to find <span class="math inline">\((L(\mathbf{X}), U(\mathbf{X}))\)</span>.</p>
<div class="section level3">
<h3 id="shortest-prediction-interval-with-no-correction">Shortest prediction interval (with no correction)<a class="anchor" aria-label="anchor" href="#shortest-prediction-interval-with-no-correction"></a>
</h3>
<p>Find the shortest intervals <span class="math inline">\((X_{(r)},
X_{(r+k)})\)</span> such that <span class="math inline">\(\frac{k}{n+1}
\geq 1-\alpha\)</span>. <span class="math inline">\(X_{(r)}\)</span> is
the <span class="math inline">\(r\)</span>th order statistics of <span class="math inline">\(X_1, \cdots, X_n\)</span>. Formally, <span class="math display">\[r = \arg\min_{1\leq r \leq n-k}\{X_{(r+k)} -
X_{(r)}\},\]</span> where <span class="math inline">\(k = \lceil
(1-\alpha)(n+1) \rceil\)</span>. This is the method implemented in
function from package to find the highest density interval.</p>
<p>Or equivalently, we can search for <span class="math display">\[\beta
= \arg\min_{0\leq \beta\leq \alpha}\{X_{(r+k)} - X_{(r)}\},\]</span>
where <span class="math inline">\(r = \lfloor (n+1)\beta\rfloor\)</span>
and <span class="math inline">\(r+k = \lceil
(n+1)(1-\alpha+\beta)\rceil\)</span>.</p>
<p>If <span class="math inline">\(r\)</span>(or <span class="math inline">\(\beta\)</span>) is pre-specified or chosen at
random, the above prediction interval <span class="math inline">\((X_{(r)}, X_{(r+k)})\)</span> has coverage rate at
least <span class="math inline">\(1-\alpha\)</span>. However, the
searching process introduces dependence of the positioning on the data,
and the selected shortest prediction interval will suffer from
under-coverage problem.</p>
<p>The function searching for the shortest interval is
<code>shortest.pi</code>, which takes a data vector <code>x</code> and
nominal error rate <code>alpha</code> as input, searches along a
sequence of <span class="math inline">\(\beta =
\{k*\alpha/50\}_{k=1}^{50}\)</span>, and returns the shortest interval
<span class="math inline">\((X_{(r)}, X_{(r+k)})\)</span>, where <span class="math inline">\(r = \lfloor (n+1)\beta\rfloor\)</span> and <span class="math inline">\(r+k = \lceil
(n+1)(1-\alpha+\beta)\rceil\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100723</span><span class="op">)</span></span>
<span><span class="co">## simulate data from normal distribution as an example</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="fu"><a href="../reference/shortest.pi.html">shortest.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -1.893637  2.092619</span></span></code></pre></div>
<p>Function <code>random.pi</code> illustrate the effect of picking
<span class="math inline">\(\beta\)</span> value at random from <span class="math inline">\((0, \alpha)\)</span>, or you may specify
<code>beta</code> as the probability on the left tail.</p>
<p><code>random.pi</code> may take an additional parameter
<code>beta</code>. If <code>beta</code> is unspecified, its value will
be chosen uniformly at random from <span class="math inline">\((0,
\alpha)\)</span>; otherwise the specified <code>beta</code> will be used
by the function. You may provide a random <code>beta</code> generated
from another distribution other than Uniform. It is always safer to
specify <code>beta</code> as you will know its value.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## random positioning</span></span>
<span><span class="fu"><a href="../reference/random.pi.html">random.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -1.939332  2.070077</span></span>
<span></span>
<span><span class="co">## specify equal tailed positioning</span></span>
<span><span class="fu"><a href="../reference/random.pi.html">random.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span>, beta <span class="op">=</span> <span class="va">alpha</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -1.939332  2.063982</span></span>
<span></span>
<span><span class="co">## specify any positioning</span></span>
<span><span class="fu"><a href="../reference/random.pi.html">random.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span>, <span class="va">alpha</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -2.881872  1.810862</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="conservative-prediction-interval">Conservative Prediction interval<a class="anchor" aria-label="anchor" href="#conservative-prediction-interval"></a>
</h3>
<p>The conservative prediction interval is obtained by choosing the
shortest of the intervals <span class="math inline">\((X_{(r)},
X_{(n+k)})\)</span> for <span class="math inline">\(r = 1,\cdots
,n-k\)</span>, where <span class="math inline">\(k = \lceil n(1-\alpha)
+ 1.12\sqrt{n\alpha}\rceil\)</span>.</p>
<p>This method is proposed by Frey in 2013 paper “Data-driven
nonparametric prediction intervals”. The boost of nominal coverage rate
is going to offset the under-coverage problem. This method is called
conservative since it achieves the nominal coverage rate <span class="math inline">\(1-\alpha\)</span> in the worst case scenario,
i.e.,</p>
<p><span class="math display">\[\text{inf}_{F\in\mathcal{F}}P(L(\mathbf{X})&lt;X_{n+1}&lt;U(\mathbf{X}))\geq
1-\alpha\]</span></p>
<p>where <span class="math inline">\(\mathcal{F}\)</span> is the set of
distributions under consideration. Oftentimes, the interval obtained
through this method is wider than necessary.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/conservative.pi.html">conservative.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -2.049211  2.070077</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prediction-interval-using-cross-validation">Prediction interval using cross validation<a class="anchor" aria-label="anchor" href="#prediction-interval-using-cross-validation"></a>
</h3>
<p>The idea of boosting the nominal coverage rate from Frey(2013) is
adopted. Instead of using coverage rate <span class="math inline">\(1-\alpha +1.12\sqrt{\frac{\alpha}{n}}\)</span>, we
will use cross validation to find the new coverage rate <span class="math inline">\(1-\alpha + b\)</span>, where <span class="math inline">\(b\in(0,\alpha)\)</span> stands for “boost”.</p>
<p>In k-fold cross-validation, the original sample is randomly
partitioned into <span class="math inline">\(k\)</span> equal sized
subsamples. Of the <span class="math inline">\(k\)</span> subsamples, a
single subsample is retained as the validation data for testing the
model, and the remaining <span class="math inline">\(k-1\)</span>
subsamples are used as training data. Find the shortest prediction
interval with a nominal coverage probability <span class="math inline">\(1-\alpha+b\)</span> using training data set and
evaluate its empirical coverage rate on the testing data set. The chosen
<span class="math inline">\(b^*\)</span> is the one having a more
accurate coverage probability on the testing data set. Finally use all
the data to find the shortest prediction interval with nominal coverage
rate <span class="math inline">\(1-\alpha+b^*\)</span>.</p>
<p>The function <code>cv.pi</code> calculated the corrected shortest
prediction interval based on <span class="math inline">\(K\)</span> fold
cross validation. The default value for <code>K</code> is 2 to reduce
calculation time.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cv.pi.html">cv.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span>, K <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -1.893637  2.092619</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="other-functions">Other functions<a class="anchor" aria-label="anchor" href="#other-functions"></a>
</h3>
<ul>
<li>get prediction interval for simulated data</li>
</ul>
<p>The function <code>get.interval</code> let user get the prediction
interval based on a simulated data set. It supports four methods to get
prediction intervals: shortest with no correction, conservative and
cross-validation method, as well as picking a random <span class="math inline">\(\beta\)</span> value. Four types of distributions
are possible to be specified for this function: normal, uniform,
exponential and gamma.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># more details in ?get.interval</span></span>
<span><span class="co"># Example: generate the samples from standard normal distribution</span></span>
<span><span class="co"># use cross validation method to get the prediction interval using the generated sample</span></span>
<span><span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/get.interval.html">get.interval</a></span><span class="op">(</span>METHOD <span class="op">=</span> <span class="fl">3</span>, DIST <span class="op">=</span> <span class="st">"Normal"</span>, n <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># things needed for the plot below</span></span>
<span><span class="va">lower_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">interval</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">upper_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">interval</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co"># A histogram of the sample with a shaded area representing the range of the prediction interval</span></span>
<span><span class="co"># inputs: sample data, lower bound of the prediction interval, upper bound of the prediction interval </span></span>
<span><span class="co"># output: a plot</span></span>
<span><span class="va">h</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">data</span>, breaks<span class="op">=</span><span class="fl">50</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">cuts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">h</span><span class="op">$</span><span class="va">breaks</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lower_q</span>, <span class="va">upper_q</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">h</span><span class="op">$</span><span class="va">breaks</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">h</span><span class="op">$</span><span class="va">counts</span>,<span class="fl">0</span><span class="op">)</span> ,type<span class="op">=</span><span class="st">"s"</span>,col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">h</span>, col<span class="op">=</span><span class="st">"gray"</span><span class="op">[</span><span class="va">cuts</span><span class="op">]</span>, lty<span class="op">=</span><span class="st">"blank"</span>, add<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="vhdi_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
<ul>
<li>quantile calculation</li>
</ul>
<p>The functions <code>upper.quantile</code> and
<code>lower.quantile</code> gives the quantiles for a given data
vector.</p>
<p>For a data vector <code>v</code> of length <span class="math inline">\(n\)</span>, and the desired probability
<code>prob</code>, <code>upper.quantile</code> finds the <span class="math inline">\(\lceil (n+1)prob \rceil\)</span>th order statistic
of <code>v</code> and <code>lower.quantile</code> finds the <span class="math inline">\(\lfloor (n+1)prob \rfloor\)</span>th order
statistic of <code>v</code>. Note that <code>prob</code> always
specifies the probability mass on the left tail. In this package,
<code>upper.quantile</code> is usually used to find the <span class="math inline">\((1-\alpha+\beta)\times 100\)</span> percentile and
<code>lower.quantile</code> is usually used to find the <span class="math inline">\(\beta\times 100\)</span> percentile.</p>
</div>
<div class="section level3">
<h3 id="no-finite-interval-warning">“No finite interval” warning<a class="anchor" aria-label="anchor" href="#no-finite-interval-warning"></a>
</h3>
<p>Some times the functions <code>conservative.pi</code>,
<code>shortest.pi</code>, <code>cv.pi</code> or
<code>get.interval</code> may throw a warning message saying “No finite
interval at given rate, returning min(x) and Inf”, this is due to the
sample size is not large enough for the given coverage rate.</p>
<p>For a sample of size <span class="math inline">\(n\)</span> <span class="math inline">\(\{X_1, \cdots, X_n\}\)</span>, assume the <span class="math inline">\(n\)</span> points are distinct, then they segment
the real line into <span class="math inline">\(n+1\)</span> parts: <span class="math inline">\((-Inf, X_{(1)}), (X_{(1)}, X_{(2)}),\cdots,
(X_{(n)}, Inf)\)</span>. Any finite-length interval can have at most
<span class="math inline">\(\frac{n-1}{n+1}\)</span> coverage rate. If
the error rate used in calculation is less than <span class="math inline">\(\frac{2}{n+1}\)</span>, it is impossible to get a
finite interval.</p>
<p>For <code>random.pi</code>, the positioning <code>beta</code> can
impact the result as well. For <span class="math inline">\(\beta&lt;
\frac{1}{n+1}\)</span>, no finite lower bound is possible; for <span class="math inline">\(\beta &gt; \alpha - \frac{1}{n+1}\)</span>, no
finite upper bound is possible.</p>
</div>
</div>
<div class="section level2">
<h2 id="performance-evaluated-using-simulated-data">Performance evaluated using simulated data<a class="anchor" aria-label="anchor" href="#performance-evaluated-using-simulated-data"></a>
</h2>
<div class="section level3">
<h3 id="comparison-of-the-coverage">Comparison of the coverage<a class="anchor" aria-label="anchor" href="#comparison-of-the-coverage"></a>
</h3>
<p>We conduct 100 experiments. For each experiment, we get the
prediction interval using simulated data and get the coverage
probability of the the prediction interval on the test data generated
from the same distribution as the simulated data. The boxplot of 100
coverage probabilities is shown.</p>
<div class="section level4">
<h4 id="uniform-distribution">Uniform distribution<a class="anchor" aria-label="anchor" href="#uniform-distribution"></a>
</h4>
<p>As Frey(2013) mentioned, uniform distribution is the worst case
scenario for the method of naively searching for shortest prediction
interval among all the distributions. Intuitively, since the interval
length totally stands for probability mass contained under the uniform
density curve, the shortest interval for uniform distribution is
equivalent to the least probability.</p>
<p>The conservative prediction interval proposed by Frey(2013)
guarantees valid coverage for uniform distribution, thus all the
distributions.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co">## training sample size</span></span>
<span><span class="va">n0</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co">## test sample size</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span> <span class="co">## nominal error rate</span></span>
<span><span class="va">n_exp</span> <span class="op">=</span> <span class="fl">100</span> <span class="co"># number of experiments</span></span>
<span><span class="va">n_method</span>  <span class="op">=</span> <span class="fl">4</span> <span class="co"># number of methods</span></span>
<span><span class="va">cov.box</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">n_exp</span>, ncol <span class="op">=</span> <span class="va">n_method</span><span class="op">)</span></span>
<span><span class="va">len.box</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">n_exp</span>, ncol <span class="op">=</span> <span class="va">n_method</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_exp</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">beta</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">x0</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/shortest.pi.html">shortest.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>  <span class="va">shortest_lower_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">shortest_upper_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">coverage.x0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">shortest_lower_q</span><span class="op">&lt;=</span> <span class="va">x0</span> <span class="op">&amp;</span> <span class="va">shortest_upper_q</span> <span class="op">&gt;=</span><span class="va">x0</span><span class="op">)</span></span>
<span>  <span class="va">cov.box</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">coverage.x0</span></span>
<span>  <span class="va">len.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">shortest_upper_q</span> <span class="op">-</span> <span class="va">shortest_lower_q</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/random.pi.html">random.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span>, <span class="va">beta</span><span class="op">)</span></span>
<span>  <span class="va">random_lower_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">random_upper_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">coverage.x0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">random_lower_q</span><span class="op">&lt;=</span> <span class="va">x0</span> <span class="op">&amp;</span> <span class="va">random_upper_q</span> <span class="op">&gt;=</span><span class="va">x0</span><span class="op">)</span></span>
<span>  <span class="va">cov.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="va">coverage.x0</span></span>
<span>  <span class="va">len.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">random_upper_q</span> <span class="op">-</span> <span class="va">random_lower_q</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/cv.pi.html">cv.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span>, K <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="va">cv_lower_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">cv_upper_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">coverage.x0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cv_lower_q</span><span class="op">&lt;=</span> <span class="va">x0</span> <span class="op">&amp;</span> <span class="va">cv_upper_q</span> <span class="op">&gt;=</span><span class="va">x0</span><span class="op">)</span></span>
<span>  <span class="va">cov.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="va">coverage.x0</span></span>
<span>  <span class="va">len.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cv_upper_q</span> <span class="op">-</span> <span class="va">cv_lower_q</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/conservative.pi.html">conservative.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>  <span class="va">cons_lower_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">cons_upper_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">coverage.x0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cons_lower_q</span><span class="op">&lt;=</span> <span class="va">x0</span> <span class="op">&amp;</span> <span class="va">cons_upper_q</span> <span class="op">&gt;=</span><span class="va">x0</span><span class="op">)</span></span>
<span>  <span class="va">cov.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">=</span> <span class="va">coverage.x0</span></span>
<span>  <span class="va">len.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cons_upper_q</span> <span class="op">-</span> <span class="va">cons_lower_q</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Warning in random.pi(x, alpha, beta): No finite interval at coverage given rate</span></span>
<span><span class="co">#&gt; and random position.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in random.pi(x, alpha, beta): No finite interval at coverage given rate</span></span>
<span><span class="co">#&gt; and random position.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in random.pi(x, alpha, beta): No finite interval at coverage given rate</span></span>
<span><span class="co">#&gt; and random position.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">cov.box</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Coverage"</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>, <span class="st">'='</span>, <span class="va">alpha</span>, <span class="st">'Uniform'</span><span class="op">)</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shortest"</span>, <span class="st">"random"</span>, <span class="st">"cross validation"</span>, <span class="st">"conservative"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">alpha</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<p><img src="vhdi_files/figure-html/unnamed-chunk-8-1.png" width="768"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">len.box</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Length"</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>, <span class="st">'='</span>, <span class="va">alpha</span>, <span class="st">'Uniform'</span><span class="op">)</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shortest"</span>, <span class="st">"random"</span>, <span class="st">"cross validation"</span>, <span class="st">"conservative"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in bplt(at[i], wid = width[i], stats = z$stats[, i], out = z$out[z$group</span></span>
<span><span class="co">#&gt; == : Outlier (Inf) in boxplot 2 is not drawn</span></span></code></pre></div>
<p><img src="vhdi_files/figure-html/unnamed-chunk-8-2.png" width="768"></p>
</div>
<div class="section level4">
<h4 id="normal-distribution">Normal distribution<a class="anchor" aria-label="anchor" href="#normal-distribution"></a>
</h4>
<p>When data is not skewed, naive shortest prediction interval may under
cover; the conservative method may give too wide an interval when data
is not uniform.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co">## training sample size</span></span>
<span><span class="va">n0</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co">## test sample size</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span> <span class="co">## nominal error rate</span></span>
<span><span class="va">n_exp</span> <span class="op">=</span> <span class="fl">100</span> <span class="co"># number of experiments</span></span>
<span><span class="va">n_method</span>  <span class="op">=</span> <span class="fl">4</span> <span class="co"># number of methods</span></span>
<span><span class="va">cov.box</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">n_exp</span>, ncol <span class="op">=</span> <span class="va">n_method</span><span class="op">)</span></span>
<span><span class="va">len.box</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">n_exp</span>, ncol <span class="op">=</span> <span class="va">n_method</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_exp</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">beta</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span>  <span class="va">x0</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n0</span>, <span class="fl">0</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/shortest.pi.html">shortest.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>  <span class="va">shortest_lower_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">shortest_upper_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">coverage.x0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">shortest_lower_q</span><span class="op">&lt;=</span> <span class="va">x0</span> <span class="op">&amp;</span> <span class="va">shortest_upper_q</span> <span class="op">&gt;=</span><span class="va">x0</span><span class="op">)</span></span>
<span>  <span class="va">cov.box</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">coverage.x0</span></span>
<span>  <span class="va">len.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">shortest_upper_q</span> <span class="op">-</span> <span class="va">shortest_lower_q</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/random.pi.html">random.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span>, <span class="va">beta</span><span class="op">)</span></span>
<span>  <span class="va">random_lower_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">random_upper_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">coverage.x0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">random_lower_q</span><span class="op">&lt;=</span> <span class="va">x0</span> <span class="op">&amp;</span> <span class="va">random_upper_q</span> <span class="op">&gt;=</span><span class="va">x0</span><span class="op">)</span></span>
<span>  <span class="va">cov.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="va">coverage.x0</span></span>
<span>  <span class="va">len.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">random_upper_q</span> <span class="op">-</span> <span class="va">random_lower_q</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/cv.pi.html">cv.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span>, K <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="va">cv_lower_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">cv_upper_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">coverage.x0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cv_lower_q</span><span class="op">&lt;=</span> <span class="va">x0</span> <span class="op">&amp;</span> <span class="va">cv_upper_q</span> <span class="op">&gt;=</span><span class="va">x0</span><span class="op">)</span></span>
<span>  <span class="va">cov.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="va">coverage.x0</span></span>
<span>  <span class="va">len.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cv_upper_q</span> <span class="op">-</span> <span class="va">cv_lower_q</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/conservative.pi.html">conservative.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>  <span class="va">cons_lower_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">cons_upper_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">coverage.x0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cons_lower_q</span><span class="op">&lt;=</span> <span class="va">x0</span> <span class="op">&amp;</span> <span class="va">cons_upper_q</span> <span class="op">&gt;=</span><span class="va">x0</span><span class="op">)</span></span>
<span>  <span class="va">cov.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">=</span> <span class="va">coverage.x0</span></span>
<span>  <span class="va">len.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cons_upper_q</span> <span class="op">-</span> <span class="va">cons_lower_q</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Warning in random.pi(x, alpha, beta): No finite interval at coverage given rate</span></span>
<span><span class="co">#&gt; and random position.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in random.pi(x, alpha, beta): No finite interval at coverage given rate</span></span>
<span><span class="co">#&gt; and random position.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in random.pi(x, alpha, beta): No finite interval at coverage given rate</span></span>
<span><span class="co">#&gt; and random position.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in random.pi(x, alpha, beta): No finite interval at coverage given rate</span></span>
<span><span class="co">#&gt; and random position.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in random.pi(x, alpha, beta): No finite interval at coverage given rate</span></span>
<span><span class="co">#&gt; and random position.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">cov.box</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Coverage"</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>, <span class="st">'='</span>, <span class="va">alpha</span>, <span class="st">'Normal'</span><span class="op">)</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shortest"</span>, <span class="st">"random"</span>, <span class="st">"cross validation"</span>, <span class="st">"conservative"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">alpha</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<p><img src="vhdi_files/figure-html/unnamed-chunk-9-1.png" width="768"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">len.box</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Length"</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>, <span class="st">'='</span>, <span class="va">alpha</span>, <span class="st">'Normal'</span><span class="op">)</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shortest"</span>, <span class="st">"random"</span>, <span class="st">"cross validation"</span>, <span class="st">"conservative"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in bplt(at[i], wid = width[i], stats = z$stats[, i], out = z$out[z$group</span></span>
<span><span class="co">#&gt; == : Outlier (Inf) in boxplot 2 is not drawn</span></span></code></pre></div>
<p><img src="vhdi_files/figure-html/unnamed-chunk-9-2.png" width="768"></p>
</div>
<div class="section level4">
<h4 id="log-normal-distribution">Log normal distribution<a class="anchor" aria-label="anchor" href="#log-normal-distribution"></a>
</h4>
<p>When the data is indeed skewed, native shortest interval searching
dose not suffer as severe an under-coverage problem.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co">## training sample size</span></span>
<span><span class="va">n0</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co">## test sample size</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span> <span class="co">## nominal error rate</span></span>
<span><span class="va">n_exp</span> <span class="op">=</span> <span class="fl">100</span> <span class="co"># number of experiments</span></span>
<span><span class="va">n_method</span>  <span class="op">=</span> <span class="fl">4</span> <span class="co"># number of methods</span></span>
<span><span class="va">cov.box</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">n_exp</span>, ncol <span class="op">=</span> <span class="va">n_method</span><span class="op">)</span></span>
<span><span class="va">len.box</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">n_exp</span>, ncol <span class="op">=</span> <span class="va">n_method</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_exp</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">beta</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">x0</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="va">n0</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/shortest.pi.html">shortest.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>  <span class="va">shortest_lower_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">shortest_upper_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">coverage.x0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">shortest_lower_q</span><span class="op">&lt;=</span> <span class="va">x0</span> <span class="op">&amp;</span> <span class="va">shortest_upper_q</span> <span class="op">&gt;=</span><span class="va">x0</span><span class="op">)</span></span>
<span>  <span class="va">cov.box</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">coverage.x0</span></span>
<span>  <span class="va">len.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">shortest_upper_q</span> <span class="op">-</span> <span class="va">shortest_lower_q</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/random.pi.html">random.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span>, <span class="va">beta</span><span class="op">)</span></span>
<span>  <span class="va">random_lower_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">random_upper_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">coverage.x0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">random_lower_q</span><span class="op">&lt;=</span> <span class="va">x0</span> <span class="op">&amp;</span> <span class="va">random_upper_q</span> <span class="op">&gt;=</span><span class="va">x0</span><span class="op">)</span></span>
<span>  <span class="va">cov.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="va">coverage.x0</span></span>
<span>  <span class="va">len.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">random_upper_q</span> <span class="op">-</span> <span class="va">random_lower_q</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/cv.pi.html">cv.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span>, K <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="va">cv_lower_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">cv_upper_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">coverage.x0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cv_lower_q</span><span class="op">&lt;=</span> <span class="va">x0</span> <span class="op">&amp;</span> <span class="va">cv_upper_q</span> <span class="op">&gt;=</span><span class="va">x0</span><span class="op">)</span></span>
<span>  <span class="va">cov.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="va">coverage.x0</span></span>
<span>  <span class="va">len.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cv_upper_q</span> <span class="op">-</span> <span class="va">cv_lower_q</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/conservative.pi.html">conservative.pi</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>  <span class="va">cons_lower_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">cons_upper_q</span> <span class="op">=</span> <span class="va">res</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">coverage.x0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cons_lower_q</span><span class="op">&lt;=</span> <span class="va">x0</span> <span class="op">&amp;</span> <span class="va">cons_upper_q</span> <span class="op">&gt;=</span><span class="va">x0</span><span class="op">)</span></span>
<span>  <span class="va">cov.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">=</span> <span class="va">coverage.x0</span></span>
<span>  <span class="va">len.box</span><span class="op">[</span><span class="va">i</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cons_upper_q</span> <span class="op">-</span> <span class="va">cons_lower_q</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Warning in random.pi(x, alpha, beta): No finite interval at coverage given rate</span></span>
<span><span class="co">#&gt; and random position.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in random.pi(x, alpha, beta): No finite interval at coverage given rate</span></span>
<span><span class="co">#&gt; and random position.</span></span>
<span></span>
<span><span class="co">#&gt; Warning in random.pi(x, alpha, beta): No finite interval at coverage given rate</span></span>
<span><span class="co">#&gt; and random position.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">cov.box</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Coverage"</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>, <span class="st">'='</span>, <span class="va">alpha</span>, <span class="st">'Log normal'</span><span class="op">)</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shortest"</span>, <span class="st">"random"</span>, <span class="st">"cross validation"</span>, <span class="st">"conservative"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">alpha</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<p><img src="vhdi_files/figure-html/unnamed-chunk-10-1.png" width="768"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">len.box</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Length"</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>, <span class="st">'='</span>, <span class="va">alpha</span>, <span class="st">'Log normal'</span><span class="op">)</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shortest"</span>, <span class="st">"random"</span>, <span class="st">"cross validation"</span>, <span class="st">"conservative"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in bplt(at[i], wid = width[i], stats = z$stats[, i], out = z$out[z$group</span></span>
<span><span class="co">#&gt; == : Outlier (Inf) in boxplot 2 is not drawn</span></span></code></pre></div>
<p><img src="vhdi_files/figure-html/unnamed-chunk-10-2.png" width="768"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="future-work">Future work<a class="anchor" aria-label="anchor" href="#future-work"></a>
</h2>
<p>So far, a solid understanding for the under coverage problem is still
absent. Since when we choose <span class="math inline">\(\beta\)</span>
independent of the data (given by the random positioning method), the
prediction intervals have valid coverage rate without any correction on
the nominal error rate, we believe the dependence of positioning on data
is the cause of the under coverage problem.</p>
<p>A natural question is whether we can find the appropriate correction
for each distribution. Frey(2013) give an approximate correction for
uniform distribution, but it may be too conservative for other
distributions. Our guess is the skewness and kurtosis of a distribution
may impact the correction needed.</p>
<p>The cross validation method works fairly well for different
distributions, but the theoretical aspect of this method is not shown
yet.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Yingchao Zhou, Yichuan Bai, An Phan, Caio dos Santos.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
